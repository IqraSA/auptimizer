

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Create and run a new experiment &mdash; Auptimizer  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configure HPO Algorithm" href="algorithm.html" />
    <link rel="prev" title="Hyperparameter Optimization" href="hpo.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/AuptimizerWhiteLong.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Auptimizer Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install and Setup Auptimizer</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="hpo.html">Hyperparameter Optimization</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Create and run a new experiment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manual-modification-of-training-code">Manual modification of training code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-conversion-with-decorator">Code conversion with decorator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#auto-code-conversion">Auto code conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-experiment">Run experiment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#additional-arguments">Additional arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-runtime-configuration-for-node-aws">Additional runtime configuration for Node/AWS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#results-further-analysis">Results / further analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="algorithm.html">Configure HPO Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="early_stop.html">Early Stopping</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="r_user.html">Setup for R</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="compression_main.html">Model Compression</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="edge.html">Edge Deployment Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Auptimizer Dashboard</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer.html">For Developers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="aup.html"><strong>Auptimizer</strong> APIs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Auptimizer</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="hpo.html">Hyperparameter Optimization</a> &raquo;</li>
        
      <li>Create and run a new experiment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/experiment.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="create-and-run-a-new-experiment">
<h1>Create and run a new experiment<a class="headerlink" href="#create-and-run-a-new-experiment" title="Permalink to this headline">¶</a></h1>
<p><strong>Auptimizer</strong> only needs a modified training script and an experiment configuration file (.json) to run a new experiment.</p>
<ol class="arabic simple">
<li><p>Create the <code class="docutils literal notranslate"><span class="pre">experiment.json</span></code> file to specify the experiment configuration and hyperparameters. Using <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">aup.init</span></code> will guide you interactively. This json file structure is generally the same for most algorithms with minor modifications. See <a class="reference internal" href="algorithm.html"><span class="doc">Configure HPO Algorithm</span></a> for more details.</p></li>
<li><p>Modify your training script. We provide three approaches for modifying the training script:</p>
<ul class="simple">
<li><p><a class="reference external" href="#manual-modification-of-training-code">Manual conversion</a>;</p></li>
<li><p><a class="reference external" href="#code-conversion-with-decorator">Python decorator</a>;</p></li>
<li><p><a class="reference external" href="#auto-code-conversion">Auto conversion for script (beta)</a>.</p></li>
</ul>
</li>
<li><p>Your experiment is now ready to run via <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">aup</span> <span class="pre">experiment.json</span></code>. For more details, see <a class="reference internal" href="#run-experiment">Run experiment</a>.</p></li>
</ol>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p>For data science applications, the <strong>user</strong> (AI scientist/engineer) solves a given data mining problem with a specified
machine learning model.</p>
<p>A script (<strong>code</strong>) is written and some hyperparameters are identified to be explored during model training.</p>
<p>Typically, the user carries out an <strong>experiment</strong> to examine a range of hyperparameter combinations  and measures the
<strong>performance</strong> of the model on a hold-out dataset. For example, testing a deep learning model by exploring the learning
rate between 0 and 1, and dropout between 0.4 and 0.6. the performance is measured by accuracy.</p>
<p>Each individual training process for a given selection of hyperparameters (e.g., learning rate = 0.1, dropout = 0.5)  is
called a <strong>job</strong>.</p>
<p>All jobs run on an assigned computational <strong>resource</strong>, e.g. CPU, GPU. And after all jobs are finished, the user
retrieves the best model from the training history for further analysis or application.</p>
</div>
<div class="section" id="manual-modification-of-training-code">
<h2>Manual modification of training code<a class="headerlink" href="#manual-modification-of-training-code" title="Permalink to this headline">¶</a></h2>
<p>If you plan to change your training script manually, the general flow of the conversion process is as follows:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>parse the configuration file (first argument from command line, i.e. <code class="docutils literal notranslate"><span class="pre">sys.argv[1]</span></code>) using <code class="docutils literal notranslate"><span class="pre">aup.BasicConfig.load(sys.argv[1])</span></code>.  And use the hyperparameters parsed from the <code class="docutils literal notranslate"><span class="pre">BasicConfig</span></code> in your code, such as <code class="docutils literal notranslate"><span class="pre">config.param_name</span></code> or <code class="docutils literal notranslate"><span class="pre">config['param_name']</span></code>, where <code class="docutils literal notranslate"><span class="pre">param_name</span></code> need to be consistent with the one  used in <code class="docutils literal notranslate"><span class="pre">experiment.json</span></code>.</p></li>
<li><p>to report the result by using <code class="docutils literal notranslate"><span class="pre">aup.print_result</span></code>.</p></li>
<li><p>Add Shebang line <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">python</span></code> and make the script executable (<code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">u+x</span> <span class="pre">script.py</span></code>).</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="code-conversion-with-decorator">
<h2>Code conversion with decorator<a class="headerlink" href="#code-conversion-with-decorator" title="Permalink to this headline">¶</a></h2>
<p>For better control, you can use <cite>aup_args</cite> or <cite>aup_flags</cite> to decorate your code.  The examples are in below:</p>
<div class="figure align-default" id="id1">
<img alt="Code comparison" src="_images/comparison.png" />
<p class="caption"><span class="caption-text">Example of using decorator for code conversion.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="auto-code-conversion">
<h2>Auto code conversion<a class="headerlink" href="#auto-code-conversion" title="Permalink to this headline">¶</a></h2>
<p>If your training function takes all hyperparameters as input, then  <strong>Auptimizer</strong> converts code to run if the training script is well defined as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">aup</span><span class="o">.</span><span class="n">convert</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">exp_json</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">func_name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="p">[</span><span class="n">output</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">script</span></code> the original script used for training, it must contain the function with name <code class="docutils literal notranslate"><span class="pre">func_name</span></code>.  Also no “__main__” inside the script.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exp_json</span></code> experiment configuration defined by the user.  It must contain the hyperparameters used by <code class="docutils literal notranslate"><span class="pre">func_name</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">func_name</span></code> the entry function used for training. It uses all hyperparameters defined in <code class="docutils literal notranslate"><span class="pre">exp_json</span></code>. All other inputs need to be optional and not overlapping with the hyperparameter names.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output</span></code> optional name for output <code class="docutils literal notranslate"><span class="pre">code</span></code>.  If not specified, it creates a file with the name specified in <code class="docutils literal notranslate"><span class="pre">exp_json</span></code>.</p></li>
</ul>
<p>Check out the folder <code class="docutils literal notranslate"><span class="pre">Examples/2dfunc_diff_opt/README.md</span></code> in the repository for example usage.</p>
</div>
<div class="section" id="run-experiment">
<h2>Run experiment<a class="headerlink" href="#run-experiment" title="Permalink to this headline">¶</a></h2>
<p>Once the experiment has been correctly set up, it is very easy to start the experiment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">aup</span> <span class="n">experiment</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<div class="section" id="additional-arguments">
<h3>Additional arguments<a class="headerlink" href="#additional-arguments" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--test</span></code>: will run in test mode by executing one job</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--aup_folder</span></code>: manually specify the <code class="docutils literal notranslate"><span class="pre">.aup</span></code> folder</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--log</span></code>: set log level to <code class="docutils literal notranslate"><span class="pre">[debug,info,warn,error]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--resume</span></code>: path to a pickled file saved by a previous experiment, will resume experiment from previous saved proposer state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--sleep</span></code>: time delay for sequential jobs (avoid database collision)</p></li>
</ul>
</div>
<div class="section" id="additional-runtime-configuration-for-node-aws">
<span id="awsruntimeanchor"></span><h3>Additional runtime configuration for Node/AWS<a class="headerlink" href="#additional-runtime-configuration-for-node-aws" title="Permalink to this headline">¶</a></h3>
<p>The user should either have Auptimizer installed on the remote machine, or at a minimum, copy the <code class="docutils literal notranslate"><span class="pre">&lt;repo&gt;/src/aup.py</span></code> script to the remote machine that can be imported by the jobs.</p>
<p>Additional configuration for node/AWS environment for runtime can be specified under the <code class="docutils literal notranslate"><span class="pre">runtime_args</span></code> in the <code class="docutils literal notranslate"><span class="pre">experiment.json</span></code>.
This is important for setting up the environment on the remote machine.
The specific arguments are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prescript</span></code>: any script to be run before the job. (use ; to separate different commands)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">postscript</span></code>: any script to be run after the job.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">overwrite</span></code>: remove the existing job file if exists.  Otherwise, it will use the existing file on the node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">env</span></code>: other environment variables, listed as dictionary <cite>{“CUDA_VISIBLE_DEVICES”:”0”}</cite></p></li>
</ul>
<p>Other resource-related arguments are under <code class="docutils literal notranslate"><span class="pre">resource_args</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reconn_wait_time</span></code>: number of seconds to wait if SSH open connection is broken, before reconnecting.  Default is 30 (seconds).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_retries</span></code>: number of retry attempts, with ‘reconn_wait_time’ seconds before the job is tagged as failed. Default is 3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async_run</span></code>: whether to run the job asynchronously on the remote instance. This will allow Auptimizer to run the job on the instance and check periodically for completion, instead of maintaining an open connection. Default is False (boolean).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async_reconnect</span></code>: number of seconds to wait and reconnect to check job status of async job. Default is 30 (seconds).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async_timeout</span></code>: total number of seconds to wait from async job start before the job is tagged as failed and discarded. Default is None (seconds).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shutdown</span></code>: turn off AWS instance after Experiment finishes. (only for AWS)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connection_retry</span></code>: If starting a stopped instance, AWS connections attempts might fail initially. This variable controls the number of retry attempts every 30 seconds. Default is 10 (only for AWS).</p></li>
</ul>
<p>See <code class="docutils literal notranslate"><span class="pre">Examples/2dfunc_diff_res/</span></code> for more examples of experiment json files.</p>
</div>
</div>
<div class="section" id="results-further-analysis">
<h2>Results / further analysis<a class="headerlink" href="#results-further-analysis" title="Permalink to this headline">¶</a></h2>
<p>The output of an experiment is saved in two places:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jobs/</span></code> folder contains the configuration of each job in <code class="docutils literal notranslate"><span class="pre">&lt;job_id&gt;.json</span></code> and output of each job in <code class="docutils literal notranslate"><span class="pre">&lt;job_id&gt;.out</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.aup/sqlite.db</span></code> database file contains the experiment history (configurations and results).  All jobs for different
experiments are all saved under unique IDs, unless it has been reset.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="algorithm.html" class="btn btn-neutral float-right" title="Configure HPO Algorithm" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="hpo.html" class="btn btn-neutral float-left" title="Hyperparameter Optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, LG Electronics Inc..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>